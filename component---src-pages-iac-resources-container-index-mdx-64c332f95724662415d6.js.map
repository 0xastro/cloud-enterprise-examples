{"version":3,"sources":["webpack:///./src/pages/iac-resources/container/index.mdx"],"names":["_frontmatter","makeShortcode","name","props","console","warn","PageDescription","AnchorLinks","AnchorLink","layoutProps","MDXLayout","DefaultLayout","MDXContent","components","mdxType","small","parentName","isMDXComponent"],"mappings":"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","file":"component---src-pages-iac-resources-container-index-mdx-64c332f95724662415d6.js","sourcesContent":["import * as React from 'react'\n  /* @jsx mdx */\nimport { mdx } from '@mdx-js/react';\n/* @jsx mdx */\n\nimport DefaultLayout from \"/Users/johandry/Workspace/ibm/att-cloudnative/ibmcloud-pattern-guide/node_modules/gatsby-theme-carbon/src/templates/Default.js\";\nexport const _frontmatter = {};\n\nconst makeShortcode = name => function MDXDefaultShortcode(props) {\n  console.warn(\"Component \" + name + \" was not imported, exported, or provided by MDXProvider as global scope\");\n  return <div {...props} />;\n};\n\nconst PageDescription = makeShortcode(\"PageDescription\");\nconst AnchorLinks = makeShortcode(\"AnchorLinks\");\nconst AnchorLink = makeShortcode(\"AnchorLink\");\nconst layoutProps = {\n  _frontmatter\n};\nconst MDXLayout = DefaultLayout;\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n\n    <PageDescription mdxType=\"PageDescription\">\n      <p>{`Automating the management of the IBM Container Registry to store the Docker images and build Kubernetes clusters (IKS)`}</p>\n    </PageDescription>\n    <AnchorLinks small mdxType=\"AnchorLinks\">\n  <AnchorLink mdxType=\"AnchorLink\">IBM Cloud Container Registry</AnchorLink>\n  <AnchorLink mdxType=\"AnchorLink\">Docker push & pull</AnchorLink>\n  <AnchorLink mdxType=\"AnchorLink\">IBM Cloud Kubernetes Service</AnchorLink>\n  <AnchorLink mdxType=\"AnchorLink\">IKS with Terraform</AnchorLink>\n  <AnchorLink mdxType=\"AnchorLink\">IKS with IBM Cloud Schematics</AnchorLink>\n  <AnchorLink mdxType=\"AnchorLink\">Deploy the Application</AnchorLink>\n  <AnchorLink mdxType=\"AnchorLink\">Final Code</AnchorLink>\n  <AnchorLink mdxType=\"AnchorLink\">Clean up</AnchorLink>\n    </AnchorLinks>\n    <h2>{`IBM Cloud Container Registry`}</h2>\n    <p>{`IBM Cloud Container Registry (ICR) is used to store, manage and deploy private container images in a highly available and scalable architecture. You can also set up your own image namespace and push container images to them. To know more, read the `}<a parentName=\"p\" {...{\n        \"href\": \"https://cloud.ibm.com/docs/Registry?topic=Registry-getting-started\"\n      }}>{`Container Registry`}</a>{` documentation.`}</p>\n    <p>{`A Docker image is the basis for every container that you create. An image is created from a Dockerfile, which is a file that contains instructions to build the image. A Dockerfile might reference build artifacts in its instructions that are stored separately, such as an app, the app’s configuration, and its dependencies. Images are typically stored in a registry that can either be accessible by the public (public registry) or set up with limited access for a small group of users (private registry). By using IBM Cloud Container Registry, only users with access to your IBM Cloud account can access your images.`}</p>\n    <p>{`Lets use the same application from the previous patterns to containerize it creating a Docker image for it. Start creating a `}<inlineCode parentName=\"p\">{`Dockerfile`}</inlineCode>{` with the following content in a directory for this project (i.e. `}<inlineCode parentName=\"p\">{`containers`}</inlineCode>{`).`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-Dockerfile\",\n        \"metastring\": \"path=Dockerfile\",\n        \"path\": \"Dockerfile\"\n      }}>{`FROM node:13\n\nRUN npm install -g json-server\n\nWORKDIR /app\nVOLUME /data\n\nEXPOSE 8080\n\nCMD [ \"json-server\", \"--watch\", \"/data/db.min.json\", \"--port\", \"8080\", \"--host\", \"0.0.0.0\" ]\n`}</code></pre>\n    <p>{`Copy to the `}<inlineCode parentName=\"p\">{`data`}</inlineCode>{` folder the JSON database then you are ready to verify it’s working locally running the following commands.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`docker build -t movies .\ndocker images\n\ndocker run --name movies -d --rm -p 80:8080 -v $PWD/data:/data movies\n\ncurl http://localhost/movies/675\n\ndocker stop $(docker ps -q --filter name=movies)\n`}</code></pre>\n    <p>{`To create an ICR namespace we can use the IBM Cloud CLI with the `}<inlineCode parentName=\"p\">{`container-registry`}</inlineCode>{` plugin. Make sure you have the latest version installed and you have `}<a parentName=\"p\" {...{\n        \"href\": \"/cloud-enterprise-examples/iac/setup-environment\"\n      }}>{`setup the environment`}</a>{` correctly.`}</p>\n    <p>{`Use the sub-command `}<inlineCode parentName=\"p\">{`namespace-add`}</inlineCode>{` to create the new namespace. Assuming the name is `}<inlineCode parentName=\"p\">{`iac-registry`}</inlineCode>{` use the following commands:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`ibmcloud cr namespace-list\nibmcloud cr namespace-add iac-registry\n`}</code></pre>\n    <p>{`Setup the image so you can push it into the namespace registry, for this you have to build or tag the image using the name/tag: `}<inlineCode parentName=\"p\">{`REGION.icr.io/NAMESPACE/IMAGE:TAG`}</inlineCode>{`. Use the sub-command `}<inlineCode parentName=\"p\">{`region`}</inlineCode>{` to know the registry region you are targeting, like this:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`ibmcloud cr region\n`}</code></pre>\n    <p>{`In my case I’m using region `}<inlineCode parentName=\"p\">{`us`}</inlineCode>{` so the registry is `}<inlineCode parentName=\"p\">{`us.icr.io`}</inlineCode>{`. The namespace is `}<inlineCode parentName=\"p\">{`iac-registry`}</inlineCode>{`, the image name is `}<inlineCode parentName=\"p\">{`movies`}</inlineCode>{` and the tag `}<inlineCode parentName=\"p\">{`1.0`}</inlineCode>{`, so it would be like this `}<inlineCode parentName=\"p\">{`us.icr.io/iac-registry/movies:1.0`}</inlineCode>{`. We already built the image we’ll tag or rename the image with the command `}<inlineCode parentName=\"p\">{`tag`}</inlineCode>{`, like in the following example. Check the `}<a parentName=\"p\" {...{\n        \"href\": \"https://docs.docker.com/engine/reference/commandline/build/#tag-an-image--t\"\n      }}>{`Docker run`}</a>{` documentation about how to set the image name or tag:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`docker images\ndocker tag movies us.icr.io/iac-registry/movies:1.0\n`}</code></pre>\n    <p>{`Before pushing the image to the registry it’s required to login to the ICR with the `}<inlineCode parentName=\"p\">{`login`}</inlineCode>{` sub-command, like so:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`ibmcloud cr login\n`}</code></pre>\n    <p>{`Having this done, we are ready to push the image with the Docker command `}<inlineCode parentName=\"p\">{`push`}</inlineCode>{`:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`docker push us.icr.io/iac-registry/movies:1.0\n`}</code></pre>\n    <p>{`You can check the image is there in different ways: (1) listing the images in the registry with the `}<inlineCode parentName=\"p\">{`ibmcloud`}</inlineCode>{` command, or (2) using the `}<inlineCode parentName=\"p\">{`docker`}</inlineCode>{` command to pull the image, either from a different computer or deleting the current image before, like so:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`ibmcloud cr images\n\ndocker rmi us.icr.io/iac-registry/movies:1.0\ndocker pull us.icr.io/iac-registry/movies:1.0\ndocker images\n`}</code></pre>\n    <p>{`This image is ready also to be executed by someone else with access to the ICR, they just need to execute the following `}<inlineCode parentName=\"p\">{`docker`}</inlineCode>{` command:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`docker run --name movies -d --rm -p 80:8080 -v $PWD/data:/data us.icr.io/iac-registry/movies:1.0\n`}</code></pre>\n    <p>{`where the movies database in JSON to expose is located in `}<inlineCode parentName=\"p\">{`./data/db.min.json`}</inlineCode>{`.`}</p>\n    <p>{`If your job is to have the Docker image published in a container registry then you can stop here, however most of the time we plan to do something with this Docker image such as run it locally (i.e. development or testing) or run it on a container orchestrator such as Docker Swarm or Kubernetes.`}</p>\n    <h2>{`IBM Cloud Kubernetes Service`}</h2>\n    <p>{`IBM Cloud Kubernetes Service (IKS) is a managed offering to create your own Kubernetes cluster to deploy and manage containerized apps. In this section you will create a Kubernetes cluster and deploy a simple API application using IBM Cloud CLI, Terraform and Schematics. It’s not the scope of this section to explain how to manage Kubernetes and deployments.`}</p>\n    <p>{`As always, confirm you have `}<a parentName=\"p\" {...{\n        \"href\": \"/cloud-enterprise-examples/iac/setup-environment\"\n      }}>{`setup the environment`}</a>{` correctly and installed the latest version of IBM Cloud plugin `}<inlineCode parentName=\"p\">{`kubernetes-service`}</inlineCode>{`.`}</p>\n    <p>{`To create a Kubernetes cluster using the IBM Cloud CLI you need some input parameters such as zone and worker node flavors. Get them with the following commands. In this example, we are using Zone `}<inlineCode parentName=\"p\">{`us-south-1`}</inlineCode>{` and workers node flavor `}<inlineCode parentName=\"p\">{`cx2.2x4`}</inlineCode>{`.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`ibmcloud ks zone ls --provider vpc-gen2 --show-flavors\nZONE=us-south-1\nibmcloud ks flavors --provider vpc-gen2 --zone $ZONE\nFLAVOR=cx2.2x4\n`}</code></pre>\n    <p>{`You also need a VPC and Subnet to create the Kubernetes cluster there. If you don’t have them you can also use the IBM Cloud CLI to create them, like so:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`# VPC Name: iac-iks-vpc\nibmcloud is vpc-create iac-iks-vpc\nVPC_ID=$(ibmcloud is vpcs --json | jq -r \".[] | select(.name==\\\\\"$VPC_Name\\\\\").id\")\n\n# Subnet Name iac-iks-subnet and 16 IP addresses.\nibmcloud is subnet-create iac-iks-subnet $VPC_ID --zone $ZONE --ipv4-address-count 16\nSUBNET_ID=$(ibmcloud is subnets --json | jq -r \".[] | select(.name==\\\\\"$Subnet_Name\\\\\").id\")\n`}</code></pre>\n    <p>{`The new subnet requires to allow traffic to the worker nodes, you can also do that with the IBM Cloud CLI using these commands:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`ibmcloud is security-group-create iac-iks-sg $VPC_ID    # Security Group Name: iac-iks-sg\nSG_ID=$(ibmcloud is security-groups --json | jq -r \".[] | select(.name==\\\\\"$SG_Name\\\\\").id\")\n\nibmcloud is security-group-rule-add $SG_ID inbound tcp --port-min 30000 --port-max 32767\n`}</code></pre>\n    <p>{`If you already have a VPC and Subnets, get their IDs with the following `}<inlineCode parentName=\"p\">{`ibmcloud ks`}</inlineCode>{` sub-commands:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`ibmcloud ks vpcs --provider vpc-gen2        # VPC Name: iac-iks-vpc\nVPC_ID=$(ibmcloud ks vpcs --provider vpc-gen2 --json | jq -r '.[] | select(.name==\"iac-iks-vpc\").id')\n\nibmcloud ks subnets --provider vpc-gen2 --vpc-id $VPC_ID --zone $ZONE   # Subnet Name: iac-iks-subnet\nSUBNET_ID=$(ibmcloud ks subnets --provider vpc-gen2 --vpc-id $VPC_ID --zone $ZONE --json | jq -r '.[] | select(.name==\"iac-iks-subnet\").id')\n`}</code></pre>\n    <p>{`The available Kubernetes versions to install are listed with the command `}<inlineCode parentName=\"p\">{`ibmcloud ks versions`}</inlineCode>{`. Having your input parameters you are ready to create the cluster using the `}<inlineCode parentName=\"p\">{`cluster create`}</inlineCode>{` sub-command, like this:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`NAME=iac-iks-cluster\nVERSION=1.18.2\n\nibmcloud ks cluster create vpc-gen2 \\\\\n  --name $NAME \\\\\n  --zone $ZONE \\\\\n  --vpc-id $VPC_ID \\\\\n  --subnet-id $SUBNET_ID \\\\\n  --flavor $FLAVOR \\\\\n  --version $VERSION \\\\\n  # --workers $N \\\\\n  # --entitlement cloud_pak \\\\\n  # --service-subnet $SUBNET_CIDR \\\\\n  # --pod-subnet $POD_CIDR \\\\\n  # --disable-public-service-endpoint \\\\\n`}</code></pre>\n    <p>{`The default values for the optional parameters are:`}</p>\n    <ul>\n      <li parentName=\"ul\"><inlineCode parentName=\"li\">{`N`}</inlineCode>{`: 1, this is a one worker node cluster.`}</li>\n      <li parentName=\"ul\"><inlineCode parentName=\"li\">{`SUBNET_CIDR`}</inlineCode>{`: 172.21.0.0/16`}</li>\n      <li parentName=\"ul\"><inlineCode parentName=\"li\">{`POD_CIDR`}</inlineCode>{`: 172.30.0.0/16`}</li>\n      <li parentName=\"ul\"><inlineCode parentName=\"li\">{`disable-public-service-endpoint`}</inlineCode>{`: false`}</li>\n    </ul>\n    <p>{`To identify your Kubernetes cluster status use the command `}<inlineCode parentName=\"p\">{`ibmcloud ks clusters`}</inlineCode>{`, wait a few minutes to have it up and running.`}</p>\n    <p>{`When the Kubernetes cluster state is `}<inlineCode parentName=\"p\">{`normal`}</inlineCode>{` get the configuration to access the cluster using the following command:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`ibmcloud ks cluster config --cluster $NAME\n`}</code></pre>\n    <p>{`Now you are ready to use the `}<inlineCode parentName=\"p\">{`kubectl`}</inlineCode>{` command, these are some initial commands:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`kubectl cluster-info\nkubectl get nodes\n`}</code></pre>\n    <p>{`You can know more information of the cluster with the commands:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`ibmcloud ks worker ls --cluster $NAME\nibmcloud ks cluster get --cluster $NAME\n`}</code></pre>\n    <p>{`To know more read the `}<a parentName=\"p\" {...{\n        \"href\": \"https://cloud.ibm.com/docs/containers?topic=containers-getting-started\"\n      }}>{`Kubernetes Service (IKS)`}</a>{` documentation.`}</p>\n    <h2>{`IKS with Terraform`}</h2>\n    <p>{`All the same actions executed with the IBM Cloud CLI has to be done with Terraform, lets create a new `}<inlineCode parentName=\"p\">{`main.tf`}</inlineCode>{` file with the IBM Provisioner using Gen 2, the given region and the data source to get the info of the user selected resource group.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-hcl\",\n        \"metastring\": \"path=main.tf\",\n        \"path\": \"main.tf\"\n      }}>{`provider \"ibm\" {\n  generation = 2\n  region     = var.region\n}\n\ndata \"ibm_resource_group\" \"group\" {\n  name = var.resource_group\n}\n`}</code></pre>\n    <p>{`The `}<inlineCode parentName=\"p\">{`variables.tf`}</inlineCode>{` file defines the required variables above, the project name and environment to use them as prefix to name the resources, the code would be like this:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-hcl\",\n        \"metastring\": \"path=variables.tf\",\n        \"path\": \"variables.tf\"\n      }}>{`variable \"project_name\" {}\nvariable \"environment\" {}\n\nvariable \"resource_group\" {\n  default = \"Default\"\n}\nvariable \"region\" {\n  default = \"us-south\"\n}\n`}</code></pre>\n    <p>{`To not have to enter the variables every time we execute terraform, lets add some variables value to the `}<inlineCode parentName=\"p\">{`terraform.tfvars`}</inlineCode>{` file. Make sure this file is appended to the `}<inlineCode parentName=\"p\">{`.gitignore`}</inlineCode>{` file.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-hcl\",\n        \"metastring\": \"path=terraform.tfvars\",\n        \"path\": \"terraform.tfvars\"\n      }}>{`project_name = \"iac-iks-test\"\nenvironment  = \"dev\"\n\n# Optional variables\nresource_group = \"Default\"\nregion         = \"us-south\"\n`}</code></pre>\n    <p>{`The IKS clusters needs a VPC, Subnet(s) and Security Group(s) just like we did using the IBM Cloud CLI. This time we’ll create a VPC and multiple subnets, then one security group per subnet allowing inbound traffic to ports 30000 - 32767. Same as you did on `}<a parentName=\"p\" {...{\n        \"href\": \"/cloud-enterprise-examples/e03bc2f7b61a09c3f6456227400cfb66/index.mdx\"\n      }}>{`Network`}</a>{` and `}<a parentName=\"p\" {...{\n        \"href\": \"/cloud-enterprise-examples/961458b1f6952f986ffd07da84db2d0a/index.mdx\"\n      }}>{`Compute`}</a>{` the number of subnets is defined by the number of zones provided by the user. Lets code this in the `}<inlineCode parentName=\"p\">{`network.tf`}</inlineCode>{` file and append the following variables to `}<inlineCode parentName=\"p\">{`variables.tf`}</inlineCode>{`.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-hcl\",\n        \"metastring\": \"path=network.tf\",\n        \"path\": \"network.tf\"\n      }}>{`resource \"ibm_is_vpc\" \"iac_iks_vpc\" {\n  name = \"\\${var.project_name}-\\${var.environment}-vpc\"\n}\n\nresource \"ibm_is_subnet\" \"iac_iks_subnet\" {\n  count                    = local.max_size\n  name                     = \"\\${var.project_name}-\\${var.environment}-subnet-\\${format(\"%02s\", count.index)}\"\n  zone                     = var.vpc_zone_names[count.index]\n  vpc                      = ibm_is_vpc.iac_iks_vpc.id\n  total_ipv4_address_count = 256\n  resource_group           = data.ibm_resource_group.group.id\n}\n\nresource \"ibm_is_security_group\" \"iac_iks_security_group\" {\n  name           = \"\\${var.project_name}-\\${var.environment}-sg-public\"\n  vpc            = ibm_is_vpc.iac_iks_vpc.id\n  resource_group = data.ibm_resource_group.group.id\n}\n\nresource \"ibm_is_security_group_rule\" \"iac_iks_security_group_rule_tcp_k8s\" {\n  count     = local.max_size\n  group     = ibm_is_security_group.iac_iks_security_group.id\n  direction = \"inbound\"\n  remote    = ibm_is_subnet.iac_iks_subnet[count.index].ipv4_cidr_block\n\n  tcp {\n    port_min = 30000\n    port_max = 32767\n  }\n}\n`}</code></pre>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-hcl\",\n        \"metastring\": \"path=variables.tf\",\n        \"path\": \"variables.tf\"\n      }}>{`  ...\nvariable \"vpc_zone_names\" {\n  type    = list(string)\n  default = [\"us-south-1\", \"us-south-2\", \"us-south-3\"]\n}\n\nlocals {\n  max_size = length(var.vpc_zone_names)\n}\n`}</code></pre>\n    <p>{`Last but not least, create the `}<inlineCode parentName=\"p\">{`iks.tf`}</inlineCode>{` file to define the IKS cluster using the `}<inlineCode parentName=\"p\">{`ibm_container_vpc_cluster`}</inlineCode>{` resource. The following code also takes the Kubernetes version, worker nodes flavor and number from the variables `}<inlineCode parentName=\"p\">{`k8s_version`}</inlineCode>{`, `}<inlineCode parentName=\"p\">{`flavor`}</inlineCode>{` and `}<inlineCode parentName=\"p\">{`workers_count`}</inlineCode>{`, so lets add them to the `}<inlineCode parentName=\"p\">{`variables.tf`}</inlineCode>{` file.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-hcl\",\n        \"metastring\": \"path=iks.tf\",\n        \"path\": \"iks.tf\"\n      }}>{`resource \"ibm_container_vpc_cluster\" \"iac_iks_cluster\" {\n  name              = \"\\${var.project_name}-\\${var.environment}-cluster\"\n  vpc_id            = ibm_is_vpc.iac_iks_vpc.id\n  flavor            = var.flavor\n  worker_count      = var.workers_count[0]\n  kube_version      = var.k8s_version\n  resource_group_id = data.ibm_resource_group.group.id\n  zones {\n    name      = var.vpc_zone_names[0]\n    subnet_id = ibm_is_subnet.iac_iks_subnet[0].id\n  }\n}\n`}</code></pre>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-hcl\",\n        \"metastring\": \"path=variables.tf\",\n        \"path\": \"variables.tf\"\n      }}>{`  ...\nvariable \"flavor\" {\n  default = \"cx2.2x4\"\n}\nvariable \"workers_count\" {\n  default = 3\n}\nvariable \"k8s_version\" {\n  default = \"1.18.2\"\n}\n`}</code></pre>\n    <p>{`This will create a Kubernetes cluster of 3 worker nodes with 2 CPU and 4 Gb Memory. To know the available flavors in the zone, use the following IBM Cloud CLI command:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`ibmcloud ks zone ls --provider vpc-gen2 --show-flavors\n\n# Or\nZONE=us-south-1\nibmcloud ks flavors --provider vpc-gen2 --zone $ZONE\n`}</code></pre>\n    <p>{`To sort them by CPU and memory, use the same command with `}<inlineCode parentName=\"p\">{`sort`}</inlineCode>{`:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`ZONE=us-south-1\nibmcloud ks flavors --provider vpc-gen2 --zone $ZONE -s | sort -k2 -k3 -n\n`}</code></pre>\n    <p>{`The main input parameters of the `}<inlineCode parentName=\"p\">{`ibm_container_vpc_cluster`}</inlineCode>{` resource are listed in the following table:`}</p>\n    <table>\n      <thead parentName=\"table\">\n        <tr parentName=\"thead\">\n          <th parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`Input parameter`}</th>\n          <th parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`Description`}</th>\n        </tr>\n      </thead>\n      <tbody parentName=\"table\">\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}><inlineCode parentName=\"td\">{`name`}</inlineCode></td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`name of the cluster`}</td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}><inlineCode parentName=\"td\">{`vpc_id`}</inlineCode></td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`ID of the VPC that you want to use for your cluster`}</td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}><inlineCode parentName=\"td\">{`flavor`}</inlineCode></td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`flavor of the VPC worker node`}</td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}><inlineCode parentName=\"td\">{`zones`}</inlineCode></td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`nested block describing the zones of this VPC cluster`}</td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}><inlineCode parentName=\"td\">{`zones.name`}</inlineCode></td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`name of the zone`}</td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}><inlineCode parentName=\"td\">{`zones.subnet_id`}</inlineCode></td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`subnet in the zone to assign the cluster`}</td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}><inlineCode parentName=\"td\">{`worker_count`}</inlineCode></td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`(optional) number of worker nodes per zone in the default worker pool. Default value `}<inlineCode parentName=\"td\">{`1`}</inlineCode></td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}><inlineCode parentName=\"td\">{`kube_version`}</inlineCode></td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`(optional) Kubernetes version, including the major.minor version. If not set, the default version from `}<inlineCode parentName=\"td\">{`ibmcloud ks versions`}</inlineCode>{` is used`}</td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}><inlineCode parentName=\"td\">{`resource_group_id`}</inlineCode></td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`(optional) ID of the resource group. Defaults to `}<inlineCode parentName=\"td\">{`default`}</inlineCode></td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}><inlineCode parentName=\"td\">{`wait_till`}</inlineCode></td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`(optional) marks the creation of your cluster complete when the given stage is achieved, read below to know the available stages and how this can help you speed up the terraform execution`}</td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}><inlineCode parentName=\"td\">{`disable_public_service_endpoint`}</inlineCode></td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`(optional) disable the master public service endpoint to prevent public access. Defaults to `}<inlineCode parentName=\"td\">{`true`}</inlineCode></td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}><inlineCode parentName=\"td\">{`pod_subnet`}</inlineCode></td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`(optional) subnet CIDR to provide private IP addresses for pods. Defaults to `}<inlineCode parentName=\"td\">{`172.30.0.0/16`}</inlineCode></td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}><inlineCode parentName=\"td\">{`service_subnet`}</inlineCode></td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`(optional) subnet CIDR to provide private IP addresses for services. Defaults to `}<inlineCode parentName=\"td\">{`172.21.0.0/16`}</inlineCode></td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}><inlineCode parentName=\"td\">{`tags`}</inlineCode></td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`(optional) list of tags to associate with your cluster`}</td>\n        </tr>\n      </tbody>\n    </table>\n    <p>{`The creation of a cluster can take some minutes to complete. To avoid long wait times, you can specify the stage when you want Terraform to mark the cluster resource creation as completed. The cluster creation might not be fully completed and continues to run in the background, however this can help you to continue with the code execution without waiting for the cluster to be fully created.`}</p>\n    <p>{`To set the waiting stage, use the `}<inlineCode parentName=\"p\">{`wait_till`}</inlineCode>{` with one of the following stages:`}</p>\n    <ul>\n      <li parentName=\"ul\"><strong parentName=\"li\">{`MasterNodeReady`}</strong>{`: Terraform marks the creation of your cluster complete when the cluster master is in a ready state.`}</li>\n      <li parentName=\"ul\"><strong parentName=\"li\">{`OneWorkerNodeReady`}</strong>{`: Waits until the master and at least one worker node are in a ready state.`}</li>\n      <li parentName=\"ul\"><strong parentName=\"li\">{`IngressReady`}</strong>{`: Waits until the cluster master and all worker nodes are in a ready state, and the Ingress subdomain is fully set up. This is the default value.`}</li>\n    </ul>\n    <p>{`This would be enough to have an IKS cluster running. Just need to execute `}<inlineCode parentName=\"p\">{`terraform apply`}</inlineCode>{`, however lets create workers pools, one in each subnet or zone, using the resource `}<inlineCode parentName=\"p\">{`ibm_container_vpc_worker_pool`}</inlineCode>{`. Replace the code in `}<inlineCode parentName=\"p\">{`iks.tf`}</inlineCode>{` file for the following code and modify the variables used for the number of workers and its flavor.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-hcl\",\n        \"metastring\": \"path=iks.tf\",\n        \"path\": \"iks.tf\"\n      }}>{`resource \"ibm_container_vpc_cluster\" \"iac_iks_cluster\" {\n  name              = \"\\${var.project_name}-\\${var.environment}-cluster\"\n  vpc_id            = ibm_is_vpc.iac_iks_vpc.id\n  flavor            = var.flavors[0]\n  worker_count      = var.workers_count[0]\n  kube_version      = var.k8s_version\n  resource_group_id = data.ibm_resource_group.group.id\n  wait_till         = \"OneWorkerNodeReady\"\n  zones {\n    name      = var.vpc_zone_names[0]\n    subnet_id = ibm_is_subnet.iac_iks_subnet[0].id\n  }\n}\n\nresource \"ibm_container_vpc_worker_pool\" \"iac_iks_cluster_pool\" {\n  count             = local.max_size - 1\n  cluster           = ibm_container_vpc_cluster.iac_iks_cluster.id\n  worker_pool_name  = \"\\${var.project_name}-\\${var.environment}-wp-\\${format(\"%02s\", count.index + 1)}\"\n  flavor            = var.flavors[count.index + 1]\n  vpc_id            = ibm_is_vpc.iac_iks_vpc.id\n  worker_count      = var.workers_count[count.index + 1]\n  resource_group_id = data.ibm_resource_group.group.id\n  zones {\n    name      = var.vpc_zone_names[count.index + 1]\n    subnet_id = ibm_is_subnet.iac_iks_subnet[count.index + 1].id\n  }\n}\n`}</code></pre>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-hcl\",\n        \"metastring\": \"path=variables.tf\",\n        \"path\": \"variables.tf\"\n      }}>{`variable \"flavors\" {\n  type    = list(string)\n  default = [\"cx2.2x4\", \"cx2.4x8\", \"cx2.8x16\"]\n}\nvariable \"workers_count\" {\n  type    = list(number)\n  default = [3, 2, 1]\n}\n`}</code></pre>\n    <p>{`The main input parameters for the `}<inlineCode parentName=\"p\">{`ibm_container_vpc_worker_pool`}</inlineCode>{` resource are similar to the parameters for `}<inlineCode parentName=\"p\">{`ibm_container_vpc_cluster`}</inlineCode>{` except for `}<inlineCode parentName=\"p\">{`worker_pool_name`}</inlineCode>{` to name the pool and `}<inlineCode parentName=\"p\">{`cluster`}</inlineCode>{` with the name or ID of the cluster set this pool.`}</p>\n    <p>{`Using a file `}<inlineCode parentName=\"p\">{`output.tf`}</inlineCode>{` helps us to get some useful information about the cluster through output variables, like so.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-hcl\",\n        \"metastring\": \"path=output.tf\",\n        \"path\": \"output.tf\"\n      }}>{``}</code></pre>\n    <p>{`Now everything is ready to create the cluster with the wellknown Terraform commands:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`terraform plan\nterraform apply\n`}</code></pre>\n    <p>{`After having the cluster ready, you can use the IBM Cloud CLI to get the cluster configuration to setup `}<inlineCode parentName=\"p\">{`kubectl`}</inlineCode>{`, like so:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`ibmcloud ks cluster config --cluster $(terraform output cluster_id)\n`}</code></pre>\n    <p>{`Enjoy the new cluster, here are some basic initial commands to verify the cluster is working`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`kubectl cluster-info\nkubectl get nodes\nkubectl get pods -A\n`}</code></pre>\n    <h3>{`A simpler IKS cluster`}</h3>\n    <p>{`For simplicity and creation speed, lets modify the `}<inlineCode parentName=\"p\">{`terraform.tfvars`}</inlineCode>{` to have a simpler cluster with one single node. This will help us to have the cluster quicker.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-hcl\",\n        \"metastring\": \"path=terraform.tfvars\",\n        \"path\": \"terraform.tfvars\"\n      }}>{`project_name = \"iac-iks-small-OWNER\"\nenvironment  = \"dev\"\n\n# Optional variables\nresource_group = \"Default\"\nregion         = \"us-south\"\nvpc_zone_names = [\"us-south-1\"]\nflavors        = [\"cx2.2x4\"]\nworkers_count  = [1]\nk8s_version    = \"1.18.2\"\n`}</code></pre>\n    <p>{`Executing `}<inlineCode parentName=\"p\">{`terraform plan & terraform apply`}</inlineCode>{` will get an IKS cluster up and running quicker than before.`}</p>\n    <h2>{`IKS with IBM Cloud Schematics`}</h2>\n    <p>{`Running this code with IBM Cloud Schematics is the same as with the other patterns. Create the `}<inlineCode parentName=\"p\">{`workspace.json`}</inlineCode>{` file adding the variables required for this code, like this one:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-json\",\n        \"metastring\": \"path=workspace.json\",\n        \"path\": \"workspace.json\"\n      }}>{`{\n  \"name\": \"iac_iks_test\",\n  \"type\": [\n    \"terraform_v0.12\"\n  ],\n  \"description\": \"Sample workspace to test IBM Cloud Schematics. Deploys an web server on a VSI with a Hello World response\",\n  \"tags\": [\n    \"app:iac_iks_test\",\n    \"owner:OWNER\",\n    \"env:dev\"\n  ],\n  \"template_repo\": {\n    \"url\": \"https://github.com/IBM/cloud-enterprise-examples/tree/master/iac/09-containers\"\n  },\n  \"template_data\": [{\n    \"folder\": \".\",\n    \"type\": \"terraform_v0.12\",\n    \"variablestore\": [{\n        \"name\": \"project_name\",\n        \"value\": \"iac-iks-test-OWNER\",\n        \"type\": \"string\"\n      },\n      {\n        \"name\": \"environment\",\n        \"value\": \"dev\",\n        \"type\": \"string\"\n      },\n      {\n        \"name\": \"region\",\n        \"value\": \"us-south\",\n        \"type\": \"string\"\n      },\n      {\n        \"name\": \"vpc_zone_names\",\n        \"value\": [\"us-south-1\", \"us-south-2\", \"us-south-3\"],\n        \"type\": \"list(string)\"\n      },\n      {\n        \"name\": \"flavors\",\n        \"value\": [\"cx2.2x4\", \"cx2.4x8\", \"cx2.8x16\"],\n        \"type\": \"list(string)\"\n      },\n      {\n        \"name\": \"workers_count\",\n        \"value\": [3, 2, 1],\n        \"type\": \"list(number)\"\n      },\n      {\n        \"name\": \"k8s_version\",\n        \"value\": \"1.18.2\",\n        \"type\": \"string\"\n      }\n    ]\n  }]\n}\n`}</code></pre>\n    <p>{`To create the workspace using the IBM Cloud CLI execute the following commands:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`ibmcloud schematics workspace new --file workspace.json\nibmcloud schematics workspace list          # Identify the WORKSPACE_ID\nWORKSPACE_ID=\n`}</code></pre>\n    <p>{`Set the variable “ because it’ll be used several times. Then plan and apply the code like so.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`ibmcloud schematics plan --id $WORKSPACE_ID  # Identify the Activity_ID\nibmcloud schematics logs  --id $WORKSPACE_ID --act-id Activity_ID\n\nibmcloud schematics apply --id $WORKSPACE_ID # Identify the Activity_ID\nibmcloud schematics logs  --id $WORKSPACE_ID --act-id Activity_ID\n`}</code></pre>\n    <p>{`Note the execution of apply will take some time, so check the logs either with the IBM Cloud CLI command or using the IBM Cloud Web Console.`}</p>\n    <h2>{`Deploy the Application`}</h2>\n    <p>{`To deploy the previously built Docker image we use the Kubernetes API and resources. Lets create a deployment file either by getting it from the following example or generating it with kubectl generators, like so:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`mkdir kubernetes\nkubectl create deployment movies --image=us.icr.io/iac-registry/movies:1.0 --dry-run=client -o yaml > kubernetes/deployment.yaml\nkubectl create service nodeport movies --tcp=8080 --node-port=32000 --dry-run=client -o yaml > kubernetes/service.yaml\n`}</code></pre>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-yaml\",\n        \"metastring\": \"path=kubernetes/deployment.yaml\",\n        \"path\": \"kubernetes/deployment.yaml\"\n      }}>{`apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  labels:\n    app: movies\n  name: movies\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: movies\n  template:\n    metadata:\n      labels:\n        app: movies\n    spec:\n      containers:\n        - image: us.icr.io/iac-registry/movies:1.0\n          name: movies\n`}</code></pre>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-yaml\",\n        \"metastring\": \"path=kubernetes/service.yaml\",\n        \"path\": \"kubernetes/service.yaml\"\n      }}>{`apiVersion: v1\nkind: Service\nmetadata:\n  labels:\n    app: movies\n  name: movies\nspec:\n  ports:\n    - name: \"80\"\n      nodePort: 32000\n      port: 80\n      protocol: TCP\n      targetPort: 80\n  selector:\n    app: movies\n  type: NodePort\nstatus:\n  loadBalancer: {}\n`}</code></pre>\n    <p>{`To deploy the application execute the `}<inlineCode parentName=\"p\">{`kubectl apply`}</inlineCode>{` command like this:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`kubectl apply -f kubernetes\n`}</code></pre>\n    <h2>{`Final Code`}</h2>\n    <p>{`All the code used for this pattern is located and available to download in the GitHub repository `}<a parentName=\"p\" {...{\n        \"href\": \"https://github.com/IBM/cloud-enterprise-examples/\"\n      }}>{`https://github.com/IBM/cloud-enterprise-examples/`}</a>{` in the directory `}<a parentName=\"p\" {...{\n        \"href\": \"https://github.com/IBM/cloud-enterprise-examples/tree/master/iac/09-containers\"\n      }}>{`09-containers`}</a>{` where the main files are:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-hcl\",\n        \"metastring\": \"path=network.tf\",\n        \"path\": \"network.tf\"\n      }}>{`resource \"ibm_is_vpc\" \"iac_iks_vpc\" {\n  name = \"\\${var.project_name}-\\${var.environment}-vpc\"\n}\n\nresource \"ibm_is_subnet\" \"iac_iks_subnet\" {\n  count                    = local.max_size\n  name                     = \"\\${var.project_name}-\\${var.environment}-subnet-\\${format(\"%02s\", count.index)}\"\n  zone                     = var.vpc_zone_names[count.index]\n  vpc                      = ibm_is_vpc.iac_iks_vpc.id\n  total_ipv4_address_count = 256\n  resource_group           = data.ibm_resource_group.group.id\n}\n\nresource \"ibm_is_security_group\" \"iac_iks_security_group\" {\n  name           = \"\\${var.project_name}-\\${var.environment}-sg-public\"\n  vpc            = ibm_is_vpc.iac_iks_vpc.id\n  resource_group = data.ibm_resource_group.group.id\n}\n\nresource \"ibm_is_security_group_rule\" \"iac_iks_security_group_rule_tcp_k8s\" {\n  count     = local.max_size\n  group     = ibm_is_security_group.iac_iks_security_group.id\n  direction = \"inbound\"\n  remote    = ibm_is_subnet.iac_iks_subnet[count.index].ipv4_cidr_block\n\n  tcp {\n    port_min = 30000\n    port_max = 32767\n  }\n}\n`}</code></pre>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-hcl\",\n        \"metastring\": \"path=iks.tf\",\n        \"path\": \"iks.tf\"\n      }}>{`resource \"ibm_container_vpc_cluster\" \"iac_iks_cluster\" {\n  name              = \"\\${var.project_name}-\\${var.environment}-cluster\"\n  vpc_id            = ibm_is_vpc.iac_iks_vpc.id\n  flavor            = var.flavors[0]\n  worker_count      = var.workers_count[0]\n  kube_version      = var.k8s_version\n  resource_group_id = data.ibm_resource_group.group.id\n  wait_till         = \"OneWorkerNodeReady\"\n  zones {\n    name      = var.vpc_zone_names[0]\n    subnet_id = ibm_is_subnet.iac_iks_subnet[0].id\n  }\n}\n\nresource \"ibm_container_vpc_worker_pool\" \"iac_iks_cluster_pool\" {\n  count             = local.max_size - 1\n  cluster           = ibm_container_vpc_cluster.iac_iks_cluster.id\n  worker_pool_name  = \"\\${var.project_name}-\\${var.environment}-wp-\\${format(\"%02s\", count.index + 1)}\"\n  flavor            = var.flavors[count.index + 1]\n  vpc_id            = ibm_is_vpc.iac_iks_vpc.id\n  worker_count      = var.workers_count[count.index + 1]\n  resource_group_id = data.ibm_resource_group.group.id\n  zones {\n    name      = var.vpc_zone_names[count.index + 1]\n    subnet_id = ibm_is_subnet.iac_iks_subnet[count.index + 1].id\n  }\n}\n`}</code></pre>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-hcl\",\n        \"metastring\": \"path=variables.tf\",\n        \"path\": \"variables.tf\"\n      }}>{`variable \"project_name\" {}\nvariable \"environment\" {}\n\nvariable \"resource_group\" {\n  default = \"Default\"\n}\nvariable \"region\" {\n  default = \"us-south\"\n}\nvariable \"vpc_zone_names\" {\n  type    = list(string)\n  default = [\"us-south-1\", \"us-south-2\", \"us-south-3\"]\n}\nvariable \"flavors\" {\n  type    = list(string)\n  default = [\"cx2.2x4\", \"cx2.4x8\", \"cx2.8x16\"]\n}\nvariable \"workers_count\" {\n  type    = list(number)\n  default = [3, 2, 1]\n}\nvariable \"k8s_version\" {\n  default = \"1.18.2\"\n}\n\nlocals {\n  max_size = length(var.vpc_zone_names)\n}\n`}</code></pre>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-Dockerfile\",\n        \"metastring\": \"path=Dockerfile\",\n        \"path\": \"Dockerfile\"\n      }}>{`FROM node:13\n\nRUN npm install -g json-server\n\nWORKDIR /app\nVOLUME /data\n\nEXPOSE 8080\n\nCMD [ \"json-server\", \"--watch\", \"/data/db.min.json\", \"--port\", \"8080\", \"--host\", \"0.0.0.0\" ]\n`}</code></pre>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-yaml\",\n        \"metastring\": \"path=kubernetes/deployment.yaml\",\n        \"path\": \"kubernetes/deployment.yaml\"\n      }}>{`apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  labels:\n    app: movies\n  name: movies\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: movies\n  template:\n    metadata:\n      labels:\n        app: movies\n    spec:\n      containers:\n        - image: us.icr.io/iac-registry/movies:1.0\n          name: movies\n`}</code></pre>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-yaml\",\n        \"metastring\": \"path=kubernetes/service.yaml\",\n        \"path\": \"kubernetes/service.yaml\"\n      }}>{`apiVersion: v1\nkind: Service\nmetadata:\n  labels:\n    app: movies\n  name: movies\nspec:\n  ports:\n    - name: \"80\"\n      nodePort: 32000\n      port: 80\n      protocol: TCP\n      targetPort: 80\n  selector:\n    app: movies\n  type: NodePort\nstatus:\n  loadBalancer: {}\n`}</code></pre>\n    <h2>{`Clean up`}</h2>\n    <p>{`When you are done with the Kubernetes cluster should destroy it.`}</p>\n    <p>{`If the cluster was created `}<strong parentName=\"p\">{`using the IBM Cloud CLI`}</strong>{`, execute the following commands:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`NAME=iac-iks-cluster\nibmcloud ks cluster rm --cluster $NAME\n\nSG_Name=iac-iks-sg\nSG_ID=$(ibmcloud is security-groups --json | jq -r \".[] | select(.name==\\\\\"$SG_Name\\\\\").id\")\nibmcloud is security-group-delete $SG_ID\n\nSubnet_Name=iac-iks-subnet\nSUBNET_ID=$(ibmcloud is subnets --json | jq -r \".[] | select(.name==\\\\\"$Subnet_Name\\\\\").id\")\nibmcloud is subnet-delete $SUBNET_ID\n\nVPC_Name=iac-iks-vpc\nVPC_ID=$(ibmcloud is vpcs --json | jq -r \".[] | select(.name==\\\\\"$VPC_Name\\\\\").id\")\nibmcloud is vpc-delete $VPC_Name\n`}</code></pre>\n    <p>{`If the cluster was created `}<strong parentName=\"p\">{`using Terraform`}</strong>{`, just need to execute the command:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`terraform destroy\n`}</code></pre>\n    <p>{`And, if the cluster was created `}<strong parentName=\"p\">{`using IBM Cloud Schematics`}</strong>{`, execute the following commands:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`ibmcloud schematics workspace list              # Identify the WORKSPACE_ID\nWORKSPACE_ID=\n\nibmcloud schematics destroy --id $WORKSPACE_ID  # Identify the Activity_ID\nibmcloud schematics logs  --id $WORKSPACE_ID --act-id Activity_ID\n\n# ... wait until it's done\n\nibmcloud schematics workspace delete --id $WORKSPACE_ID\nibmcloud schematics workspace list\n`}</code></pre>\n\n    </MDXLayout>;\n}\n;\nMDXContent.isMDXComponent = true;\n      "],"sourceRoot":""}